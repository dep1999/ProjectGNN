# -*- coding: utf-8 -*-
"""
è„šæœ¬åŠŸèƒ½ï¼š
- ä» HGNC æä¾›çš„ protein-coding_gene.txt æ–‡ä»¶ä¸­è¯»å–åŸºå› åï¼ˆsymbolï¼‰ä¸å…¶åˆ«åï¼ˆalias_symbolï¼‰
- æ„å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰åŸºå› å…³é”®è¯çš„é›†åˆï¼ˆæ ‡å‡†å + æ‰€æœ‰åˆ«åï¼‰
- å°†ç»“æœä¿å­˜ä¸ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œæ¯è¡Œä¸€ä¸ªå…³é”®è¯ï¼Œä¾¿äºå…±ç°åˆ†æç­‰åç»­ä½¿ç”¨
"""

import pandas as pd
import os
import sys

# ç¡®ä¿è„šæœ¬åœ¨å…¶æ‰€åœ¨æ–‡ä»¶å¤¹ä¸­è¿è¡Œ
script_dir = os.path.dirname(os.path.abspath(__file__))
os.chdir(script_dir)
print(f"ğŸ“‚ å·¥ä½œç›®å½•å·²è®¾ç½®ä¸º: {os.getcwd()}")


# ------------------------------------------------------
# æ­¥éª¤ 1ï¼šè¯»å– HGNC æ–‡ä»¶
# æ–‡ä»¶ä¸º TSVï¼ˆtab-separated valuesï¼Œåˆ¶è¡¨ç¬¦åˆ†éš”æ–‡æœ¬æ–‡ä»¶ï¼‰
# ------------------------------------------------------
input_file = "protein-coding_gene.txt"  # æ›¿æ¢ä¸ºä½ æœ¬åœ°çš„æ–‡ä»¶è·¯å¾„

# pandas.read_csv æ˜¯ç”¨äºè¯»å–è¡¨æ ¼å‹æ•°æ®çš„å‡½æ•°
# å‚æ•° sep='\t' è¡¨ç¤ºä½¿ç”¨åˆ¶è¡¨ç¬¦åˆ†éš”å­—æ®µ
# dtype=str ä¿è¯æ‰€æœ‰æ•°æ®ä»¥å­—ç¬¦ä¸²å½¢å¼è¯»å–ï¼ˆé¿å…æ•°å€¼è½¬åŒ–é”™è¯¯ï¼‰
df = pd.read_csv(input_file, sep="\t", dtype=str)

# ------------------------------------------------------
# æ­¥éª¤ 2ï¼šå¤„ç† alias_symbol å­—æ®µ
# æœ‰äº›åˆ«åå­—æ®µä¸ºç©ºï¼Œå› æ­¤å…ˆå¡«å……ç©ºå­—ç¬¦ä¸²
# ------------------------------------------------------
df["alias_symbol"] = df["alias_symbol"].fillna("")

# ------------------------------------------------------
# æ­¥éª¤ 3ï¼šæ„å»ºå…³é”®è¯é›†åˆï¼ˆset ä¸é‡å¤ï¼‰
# åŒ…å«æ‰€æœ‰ symbol å’Œæ‰€æœ‰ alias_symbol ä¸­çš„æ¯ä¸ªåˆ«å
# ------------------------------------------------------
gene_keywords = set()

# æ·»åŠ æ ‡å‡† symbol
for symbol in df["symbol"]:
    gene_keywords.add(symbol.strip())

# æ·»åŠ åˆ«å aliasï¼ˆå¯èƒ½æ˜¯ç”¨é€—å·åˆ†éš”çš„ä¸€ä¸²åˆ«åï¼‰
for alias_str in df["alias_symbol"]:
    # åˆ†å‰² alias å­—ç¬¦ä¸²ï¼Œæ³¨æ„å¯èƒ½å­˜åœ¨å¤šä¸ª alias ç”¨é€—å·éš”å¼€
    aliases = alias_str.split(",")
    for alias in aliases:
        alias = alias.strip()
        if alias:
            gene_keywords.add(alias)

# ------------------------------------------------------
# æ­¥éª¤ 4ï¼šä¿å­˜ç»“æœåˆ°æœ¬åœ°æ–‡ä»¶
# æ¯è¡Œä¸€ä¸ªåŸºå› å…³é”®è¯ï¼Œä¾¿äºä¸‹æ¸¸ NLP åˆ†è¯ã€å…±ç°åˆ†æä½¿ç”¨
# ------------------------------------------------------
output_file = "gene_keywords_list.txt"

with open(output_file, "w", encoding="utf-8") as f:
    for keyword in sorted(gene_keywords):
        f.write(keyword + "\n")

print(f"âœ… å…±æå–å…³é”®è¯æ•°ï¼š{len(gene_keywords)}")
print(f"ğŸ“„ å…³é”®è¯åˆ—è¡¨å·²ä¿å­˜ä¸ºï¼š{output_file}")
